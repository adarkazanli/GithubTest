<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test - Task Scheduler</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
    .success { background: #d4edda; color: #155724; }
    .error { background: #f8d7da; color: #721c24; }
    .info { background: #d1ecf1; color: #0c5460; }
  </style>
</head>
<body>
  <h1>Task Scheduler - Debug Test</h1>
  <div id="status"></div>

  <h2>Test Import</h2>
  <input type="file" id="excel-file" accept=".xlsx" />
  <button id="import-btn">Import Excel</button>
  <div id="result"></div>

  <!-- Load SheetJS -->
  <script src="assets/lib/xlsx.full.min.js"></script>

  <!-- Test script -->
  <script type="module">
    const statusDiv = document.getElementById('status');
    const resultDiv = document.getElementById('result');

    function log(message, type = 'info') {
      const div = document.createElement('div');
      div.className = `status ${type}`;
      div.textContent = message;
      statusDiv.appendChild(div);
      console.log(message);
    }

    // Test 1: Check if XLSX is loaded
    if (typeof XLSX !== 'undefined') {
      log('✓ XLSX library loaded', 'success');
    } else {
      log('✗ XLSX library NOT loaded', 'error');
    }

    // Test 2: Import modules
    try {
      const { default: ExcelImporter } = await import('./src/services/ExcelImporter.js');
      log('✓ ExcelImporter module loaded', 'success');

      const { default: TimeUtils } = await import('./src/utils/TimeUtils.js');
      log('✓ TimeUtils module loaded', 'success');

      const { default: StorageService } = await import('./src/services/StorageService.js');
      log('✓ StorageService module loaded', 'success');

      // Test 3: Set up file import
      const fileInput = document.getElementById('excel-file');
      const importBtn = document.getElementById('import-btn');

      importBtn.addEventListener('click', () => {
        fileInput.click();
      });

      fileInput.addEventListener('change', async (event) => {
        const file = event.target.files[0];
        if (!file) return;

        log(`Selected file: ${file.name}`, 'info');
        resultDiv.innerHTML = '<p>Processing...</p>';

        try {
          // Test the import
          const result = await ExcelImporter.importFile(file);

          log(`✓ Import successful!`, 'success');
          log(`  Valid rows: ${result.summary.valid}`, 'success');
          log(`  Invalid rows: ${result.summary.invalid}`, 'success');

          // Display tasks
          const tasksHtml = result.tasks.map((task, i) =>
            `<div>
              <strong>Task ${i + 1}:</strong>
              ${task.taskName} - ${task.estimatedDuration}
            </div>`
          ).join('');

          resultDiv.innerHTML = `
            <h3>Import Results:</h3>
            <p><strong>File:</strong> ${result.summary.fileName}</p>
            <p><strong>Valid:</strong> ${result.summary.valid}</p>
            <p><strong>Invalid:</strong> ${result.summary.invalid}</p>
            <h4>Tasks:</h4>
            ${tasksHtml || '<p>No tasks imported</p>'}
          `;

          if (result.summary.invalidRows > 0) {
            log(`⚠ ${result.summary.invalidRows} invalid rows found`, 'error');
            console.log('Invalid details:', result.summary.invalidDetails);
          }

        } catch (error) {
          log(`✗ Import failed: ${error.message}`, 'error');
          console.error('Full error:', error);
          resultDiv.innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
        }
      });

      log('✓ Event listeners set up', 'success');
      log('Ready to test! Select an Excel file.', 'info');

    } catch (error) {
      log(`✗ Module loading failed: ${error.message}`, 'error');
      console.error('Full error:', error);
    }
  </script>
</body>
</html>
